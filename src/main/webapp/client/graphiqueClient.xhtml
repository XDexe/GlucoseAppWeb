<html
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:h="http://xmlns.jcp.org/jsf/html"
        xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
        xmlns:f="http://xmlns.jcp.org/jsf/core"
        xmlns:p="http://primefaces.org/ui">
<h:head>
   <title>Test Line Chart</title>
   <meta charset="UTF-8"/>
   <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
   <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
   <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
</h:head>

<h:body>
   <h:form id="formData">
      <h:inputHidden id="isAlive" value="true"/>
      <h:inputHidden id="idActivite" value="1"/>
   </h:form>
   <canvas id="line" width="1000" height="750"></canvas>
   <script>
      let idActivite = document.getElementById('formData:idActivite')
      let isAlive = document.getElementById('formData:isAlive')
      console.log(idActivite.value)
   </script>
   <script>
      const labels = [];
      const data = {
         labels: labels,
         datasets: [{
            label: 'Taux de glucose dans le sang (mg/dL)',
            data: [],
            fill: false,
            borderColor: 'rgb(255, 87, 34)',
            tension: 0.4
         }]
      };

      const config = {
         type: 'line',
         data: data,
         options: {
            responsive: false,
            animation: false,
            plugins: {
               legend: {
                  position: 'top',
               },
               title: {
                  display: true,
                  text: 'Taux de glucose'
               }
            },
            scales: {
               x: {
                  title: {
                     display: true,
                     text: 'Temps (s)'
                  }
               },
               y: {
                  title: {
                     display: true,
                     text: 'taux de glucose (mg/dL)'
                  },
                  beginAtZero: false,
                  suggestedMin: 50,
                  suggestedMax: 220
               }
            }
         }
      };

      // Initialiser le graphique
      const lineChart = new Chart(
              document.getElementById('line'),
              config
      );

      function updateChart(newData) {
         lineChart.data.labels = newData.map((_, index) => index + 1);
         lineChart.data.datasets[0].data = newData;
         lineChart.update();
      }

      function fetchData() {
         fetch('http://localhost:8080/CardioScantest-1.0-SNAPSHOT/ws/data/chartData')
                 .then(response => response.json())
                 .then(data => {
                    updateChart(data);
                 })
                 .catch(error => console.error('Error fetching chart data:', error));
      }

      // Fetch data initially
     // fetchData();

      // Fetch data every 1 seconds
     // setInterval(fetchData, 1000);
   </script>
</h:body>
</html>
